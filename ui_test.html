<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdvancedFind UI Test</title>
  <link rel="stylesheet" href="search.css">
  <style>
    body {
      padding: 20px;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .test-container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 600px;
    }
    .test-info {
      margin-bottom: 20px;
      padding: 10px;
      background-color: #e3f2fd;
      border-radius: 4px;
      font-size: 14px;
    }
    .status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
    }
    .status.success {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    .status.error {
      background-color: #ffebee;
      color: #c62828;
    }
    .test-content {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-width: 600px;
    }
    .highlight {
      background-color: yellow;
      font-weight: bold;
    }
    .current-match {
      background-color: orange;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-info">
      <h3>AdvancedFind UI æµ‹è¯•é¡µé¢</h3>
      <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•UIç•Œé¢ï¼Œä¸åŒ…å«å®é™…çš„æœç´¢åŠŸèƒ½ã€‚</p>
      <ul>
        <li>ğŸ” æ‰§è¡Œæœç´¢æŒ‰é’®ï¼šç‚¹å‡»æ‰§è¡Œæœç´¢ï¼ˆåœ¨æ‰©å±•ç¯å¢ƒä¸­ï¼‰</li>
        <li>âš¡ å®æ—¶æœç´¢æŒ‰é’®ï¼šåˆ‡æ¢å®æ—¶æœç´¢æ¨¡å¼ï¼ˆé»˜è®¤å…³é—­ï¼‰</li>
        <li>Enteré”®ï¼šåœ¨éå®æ—¶æœç´¢æ¨¡å¼ä¸‹æŒ‰Enteré”®æ‰§è¡Œæœç´¢</li>
        <li>â†‘â†“ æ–¹å‘é”®ï¼šåœ¨æœ‰æœç´¢ç»“æœæ—¶ï¼Œä½¿ç”¨ä¸Šä¸‹æ–¹å‘é”®å¯¼èˆªç»“æœ</li>
      </ul>
    </div>
    
    <div class="advanced-find-container">
      <div class="search-input-container">
        <input type="text" id="search-input" placeholder="è¾“å…¥æœç´¢å†…å®¹" autocomplete="off">
      </div>
      <div class="search-controls">
        <button id="case-sensitive-btn" title="å¤§å°å†™åŒ¹é…">Aa</button>
        <button id="whole-word-btn" title="å…¨å­—åŒ¹é…">W</button>
        <button id="regex-btn" title="æ­£åˆ™è¡¨è¾¾å¼">.*</button>
        <button id="realtime-search-btn" title="å®æ—¶æœç´¢">âš¡</button>
      </div>
      <div class="search-actions">
        <button id="search-btn" title="æ‰§è¡Œæœç´¢">ğŸ”</button>
      </div>
      <div class="search-navigation">
        <button id="prev-btn" title="ä¸Šä¸€ä¸ªåŒ¹é…é¡¹">â–²</button>
        <span id="match-info">0/0</span>
        <button id="next-btn" title="ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹">â–¼</button>
      </div>
      <button id="close-btn" title="å…³é—­">Ã—</button>
    </div>
    
    <div id="status" class="status">
      å‡†å¤‡å°±ç»ª
    </div>
    
    <div class="test-content">
      <h3>æµ‹è¯•æ–‡æœ¬å†…å®¹</h3>
      <p>è¿™æ˜¯ä¸€æ®µç”¨äºæµ‹è¯•æœç´¢åŠŸèƒ½çš„æ–‡æœ¬ã€‚è¯·å°è¯•æœç´¢ä»¥ä¸‹å•è¯ï¼š</p>
      <ul>
        <li>Enter - è¿™ä¸ªå•è¯å‡ºç°äº†å¤šæ¬¡</li>
        <li>æœç´¢ - ä¸­æ–‡æœç´¢æµ‹è¯•</li>
        <li>test - è‹±æ–‡å•è¯æµ‹è¯•</li>
      </ul>
      <div id="test-text">
        <p>Enter the world of programming. When you press Enter key, the computer processes your input.</p>
        <p>Enteræ˜¯ä¸€ä¸ªå¸¸è§çš„è®¡ç®—æœºæœ¯è¯­ã€‚æ¯æ¬¡æŒ‰ä¸‹Enteré”®ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</p>
        <p>This is a test sentence. Another test case is here. Testing is important for quality assurance.</p>
        <p>æœç´¢åŠŸèƒ½å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„å†…å®¹ã€‚æœç´¢æ˜¯ç°ä»£åº”ç”¨ç¨‹åºçš„é‡è¦åŠŸèƒ½ã€‚</p>
        <p>Enter key is different from other keys. When you Enter text, the system processes it.</p>
        <p>Regular expressions are powerful for text searching. You can search for patterns like Enter, test, or æœç´¢.</p>
      </div>
    </div>
  </div>

  <script>
    // æ¨¡æ‹Ÿæœç´¢çŠ¶æ€
    const searchState = {
      searchTerm: '',
      caseSensitive: false,
      wholeWord: false,
      regex: false,
      realtimeSearch: false, // é»˜è®¤ä¸å®æ—¶æœç´¢
      matches: [],
      currentMatchIndex: -1
    };
    
    // åˆå§‹åŒ–UI
    function initializeTestUI() {
      try {
        // è·å–DOMå…ƒç´ 
        const searchInput = document.getElementById('search-input');
        const caseSensitiveBtn = document.getElementById('case-sensitive-btn');
        const wholeWordBtn = document.getElementById('whole-word-btn');
        const regexBtn = document.getElementById('regex-btn');
        const realtimeSearchBtn = document.getElementById('realtime-search-btn');
        const searchBtn = document.getElementById('search-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const matchInfo = document.getElementById('match-info');
        const closeBtn = document.getElementById('close-btn');
        const status = document.getElementById('status');
        
        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        searchInput.addEventListener('input', handleSearchInput);
        caseSensitiveBtn.addEventListener('click', () => toggleSearchOption('caseSensitive', caseSensitiveBtn));
        wholeWordBtn.addEventListener('click', () => toggleSearchOption('wholeWord', wholeWordBtn));
        regexBtn.addEventListener('click', () => toggleSearchOption('regex', regexBtn));
        realtimeSearchBtn.addEventListener('click', () => toggleSearchOption('realtimeSearch', realtimeSearchBtn));
        searchBtn.addEventListener('click', performSearch);
        
        prevBtn.addEventListener('click', () => navigateMatches(-1));
        nextBtn.addEventListener('click', () => navigateMatches(1));
        closeBtn.addEventListener('click', () => window.close());
        
        // ç›‘å¬ESCé”®å…³é—­ã€Enteré”®æ‰§è¡Œæœç´¢å’Œä¸Šä¸‹æ–¹å‘é”®å¯¼èˆªç»“æœ
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            updateStatus('ESCé”®è¢«æŒ‰ä¸‹ï¼Œåœ¨æ‰©å±•ç¯å¢ƒä¸­ä¼šå…³é—­å¼¹çª—', 'success');
          } else if (e.key === 'Enter' && !searchState.realtimeSearch) {
            // åœ¨éå®æ—¶æœç´¢æ¨¡å¼ä¸‹ï¼ŒæŒ‰Enteré”®æ‰§è¡Œæœç´¢
            performSearch();
          } else if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
            // å½“æœ‰æœç´¢ç»“æœæ—¶ï¼Œä½¿ç”¨ä¸Šä¸‹æ–¹å‘é”®å¯¼èˆªç»“æœ
            if (searchState.matches.length > 0) {
              e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆç§»åŠ¨å…‰æ ‡åˆ°æ–‡æœ¬å¼€å¤´/ç»“å°¾ï¼‰
              const direction = e.key === 'ArrowUp' ? -1 : 1;
              navigateMatches(direction);
            }
          }
        });
        
        // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
        searchInput.focus();
        
        updateStatus('UIåˆå§‹åŒ–æˆåŠŸï¼Œæ‰€æœ‰æŒ‰é’®äº‹ä»¶å·²ç»‘å®š', 'success');
      } catch (error) {
        updateStatus('UIåˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
      }
    }
    
    // å¤„ç†æœç´¢è¾“å…¥
    function handleSearchInput(e) {
      searchState.searchTerm = e.target.value;
      
      // åªæœ‰åœ¨å¯ç”¨å®æ—¶æœç´¢æ—¶æ‰è‡ªåŠ¨æ‰§è¡Œæœç´¢
      if (searchState.realtimeSearch) {
        performSearch();
      } else {
        updateStatus(`è¾“å…¥å†…å®¹: "${searchState.searchTerm}"ï¼Œå®æ—¶æœç´¢å·²å…³é—­ï¼Œéœ€ç‚¹å‡»æœç´¢æŒ‰é’®æˆ–æŒ‰Enteré”®æ‰§è¡Œæœç´¢`, 'success');
      }
    }
    
    // åˆ‡æ¢æœç´¢é€‰é¡¹
    function toggleSearchOption(option, button) {
      searchState[option] = !searchState[option];
      button.classList.toggle('active', searchState[option]);
      
      // å¯¹äºå®æ—¶æœç´¢é€‰é¡¹ï¼Œä¸éœ€è¦ç«‹å³æ‰§è¡Œæœç´¢
      if (option !== 'realtimeSearch') {
        performSearch();
      } else {
        const status = searchState.realtimeSearch ? 'å·²å¼€å¯' : 'å·²å…³é—­';
        updateStatus(`å®æ—¶æœç´¢${status}ï¼Œç°åœ¨è¾“å…¥å†…å®¹ä¼šè‡ªåŠ¨æ‰§è¡Œæœç´¢`, 'success');
      }
    }
    
    // æ¨¡æ‹Ÿæ‰§è¡Œæœç´¢
    function performSearch() {
      if (!searchState.searchTerm || searchState.searchTerm.trim() === '') {
        updateStatus('è¯·è¾“å…¥æœç´¢å†…å®¹', 'error');
        return;
      }
      
      // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
      clearHighlights();
      
      // è·å–æµ‹è¯•æ–‡æœ¬å†…å®¹
      const testTextElement = document.getElementById('test-text');
      const textContent = testTextElement.textContent;
      
      // åˆ›å»ºæœç´¢æ¨¡å¼
      let searchPattern;
      if (searchState.regex) {
        try {
          searchPattern = new RegExp(searchState.searchTerm, searchState.caseSensitive ? 'g' : 'gi');
        } catch (e) {
          updateStatus('æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯: ' + e.message, 'error');
          return;
        }
      } else {
        let escapedTerm = searchState.searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        if (searchState.wholeWord) {
          escapedTerm = '\\b' + escapedTerm + '\\b';
        }
        searchPattern = new RegExp(escapedTerm, searchState.caseSensitive ? 'g' : 'gi');
      }
      
      // æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹
      const matches = [];
      let match;
      while ((match = searchPattern.exec(textContent)) !== null) {
        matches.push({
          index: match.index,
          text: match[0],
          length: match[0].length
        });
      }
      
      // é«˜äº®æ‰€æœ‰åŒ¹é…é¡¹
      highlightMatches(testTextElement, matches);
      
      // æ›´æ–°æœç´¢çŠ¶æ€
      searchState.matches = matches;
      searchState.currentMatchIndex = matches.length > 0 ? 0 : -1;
      
      // å¦‚æœæœ‰åŒ¹é…é¡¹ï¼Œå¯¼èˆªåˆ°ç¬¬ä¸€ä¸ª
      if (matches.length > 0) {
        navigateToMatch(0);
      }
      
      updateMatchInfo();
      updateStatus(`æœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${matches.length} ä¸ªåŒ¹é…é¡¹`, 'success');
    }
    
    // æ¸…é™¤é«˜äº®
    function clearHighlights() {
      const testTextElement = document.getElementById('test-text');
      const originalHTML = testTextElement.innerHTML;
      // ç§»é™¤æ‰€æœ‰é«˜äº®æ ‡è®°
      testTextElement.innerHTML = originalHTML
        .replace(/<span class="highlight">/g, '')
        .replace(/<span class="current-match">/g, '')
        .replace(/<\/span>/g, '');
    }
    
    // é«˜äº®åŒ¹é…é¡¹
    function highlightMatches(element, matches) {
      if (matches.length === 0) return;
      
      let html = element.innerHTML;
      
      // ä»åå¾€å‰æ›¿æ¢ï¼Œé¿å…ç´¢å¼•å˜åŒ–
      for (let i = matches.length - 1; i >= 0; i--) {
        const match = matches[i];
        const beforeText = html.substring(0, match.index);
        const matchText = html.substring(match.index, match.index + match.length);
        const afterText = html.substring(match.index + match.length);
        
        // æ·»åŠ é«˜äº®æ ‡è®°
        html = beforeText + '<span class="highlight">' + matchText + '</span>' + afterText;
      }
      
      element.innerHTML = html;
    }
    
    // å¯¼èˆªåˆ°æŒ‡å®šåŒ¹é…é¡¹
    function navigateToMatch(index) {
      if (index < 0 || index >= searchState.matches.length) return;
      
      // æ¸…é™¤å½“å‰åŒ¹é…é«˜äº®
      const currentHighlights = document.querySelectorAll('.current-match');
      currentHighlights.forEach(el => {
        el.classList.remove('current-match');
        el.classList.add('highlight');
      });
      
      // è®¾ç½®æ–°çš„å½“å‰åŒ¹é…é«˜äº®
      const allHighlights = document.querySelectorAll('.highlight');
      if (allHighlights[index]) {
        allHighlights[index].classList.remove('highlight');
        allHighlights[index].classList.add('current-match');
        
        // æ»šåŠ¨åˆ°å½“å‰åŒ¹é…é¡¹
        allHighlights[index].scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      }
    }
    
    // å¯¼èˆªåŒ¹é…é¡¹
    function navigateMatches(direction) {
      if (searchState.matches.length === 0) {
        updateStatus('æ²¡æœ‰å¯å¯¼èˆªçš„åŒ¹é…é¡¹', 'error');
        return;
      }
      
      searchState.currentMatchIndex = (searchState.currentMatchIndex + direction + searchState.matches.length) % searchState.matches.length;
      navigateToMatch(searchState.currentMatchIndex);
      updateMatchInfo();
      updateStatus(`å¯¼èˆªåˆ°ç¬¬ ${searchState.currentMatchIndex + 1} ä¸ªåŒ¹é…é¡¹`, 'success');
    }
    
    // æ›´æ–°åŒ¹é…ä¿¡æ¯
    function updateMatchInfo() {
      const matchInfo = document.getElementById('match-info');
      if (matchInfo) {
        const { matches, currentMatchIndex } = searchState;
        const current = matches.length > 0 ? (currentMatchIndex + 1) : 0;
        matchInfo.textContent = `${current}/${matches.length}`;
      }
    }
    
    // æ›´æ–°çŠ¶æ€ä¿¡æ¯
    function updateStatus(message, type = 'success') {
      const status = document.getElementById('status');
      if (status) {
        status.textContent = message;
        status.className = `status ${type}`;
      }
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initializeTestUI);
  </script>
</body>
</html>